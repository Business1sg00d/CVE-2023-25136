#!/usr/bin/python3

import psutil
from pwn import *

process_name = "sshd"
pid = None

for proc in psutil.process_iter():
    if process_name in proc.name():
        pid = proc.pid
        address = id(pid)
        break

proc_maps = f"/proc/{pid}/maps"
with open(proc_maps, "r") as r:
    for line in r:
        field = line.split()
        if '/usr/sbin/sshd' in field: base_address = field[0].split('-')[0]
        break
        r.close()

log.success(f"sshd PID: %d", pid)
log.success(f"sshd Parent Process Base Address: %s", base_address)
main = int("0x"+base_address, 16) + int("dd30", 16)

gdbscript=f'''
set follow-fork-mode child
catch fork
catch syscall 60
catch syscall 231
'''

gdb.attach(pid, gdbscript=gdbscript)
breakpoint()
